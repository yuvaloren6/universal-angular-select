angular.module("angular-groupSort",[]).constant("EmptyElement","<div ng-transclude><\/<div>").constant("NoGrouping","!@#$%^&*()").service("Utilities",function(){this.isValue=function(n){return angular.isDefined(n)&&null!==n};this.isString=function(n){return this.isValue(n)&&typeof n=="string"&&""!==n};this.isOptionalParameter=function(n,t,i){return i.hasOwnProperty(t)&&angular.isDefined(i[t])&&null!==i[t]}}).directive("groupSort",function(n,t,i){return{scope:{groupBy:"&",objects:"=",sortCategories:"&",sortItems:"&"},template:n,restrict:"EA",transclude:Element,controller:function(n,t,r,u){var e=function(t,r){var f={},o;t.forEach(function(t){angular.isObject(t)&&(groupID=n.groupBy()(t,r),u.isString(groupID)?(f[groupID]=f[groupID]||[],f[groupID].push(t)):(f[i]=f[i]||[],f[i].push(t)))});for(o in f)i!==o&&(f[o]=e(f[o],r+1));return f},o=function(t,r){var f=[];for(var u in t)i!==u&&f.push(u);f=f.sort(function(t,i){return n.sortCategories()(t,i)});r.categories=f;for(u in t)i!==u&&(r[u]={},o(t[u],r[u]))},s=function(t){for(var r in t)i===r&&(t[r]=t[r].sort(function(t,i){return n.sortItems()(t,i)}));for(r in t)i!==r&&s(t[r])},h=function(n,t,r){var u,l={},e=[],s,c,o;if(s=t.categories.length,c=0===s,0<Object.keys(n).length){for(o=0;o<s;o++)u=t.categories[o],l=h(n[u],t[u],u),e.push(l);if(angular.isDefined(n[i])){if(c)return f(r,n[i],!0);e.push(n[i])}}return c?e:f(r,e,!1)},f=function(n,t,i){var r={};return r.isLeaf=i,r.categoryName=null!==n?n:"",r.objects=t,r};this.data=function(){var t=undefined,c=undefined,l=[];if(!angular.isArray(n.objects))throw Error("Parameter object must point to an array of objects");return u.isOptionalParameter(n,"groupBy",r)&&(t=e(n.objects,1),u.isOptionalParameter(n,"sortCategories",r)&&(c={},o(t,c))),angular.isDefined(t)||(t={},t[i]=n.objects),u.isOptionalParameter(n,"sortItems",r)&&s(t),angular.isDefined(c)?l=h(t,c,null):l.push(f(null,t,!0)),l}}}});